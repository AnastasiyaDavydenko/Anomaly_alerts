# Anomaly_alerts

## Входные данные

Дана база данных в ClickHouse некоторого приложения "Лента новостей и мессенджер". База данных состоит из 2 таблиц feed_action и message_action:

feed_action (лента новостей):
- user_id - id пользователя,
- time - время,
- action - действие (like or view),
- age (возраст пользователя),
- city - город,
- country - страна,
- exp_group - номер экспериментальной группы для AB и AA тестов,
- gender - гендер пользователя (0- мужчина, 1- женщина),
- os - операционная система (ios, android),
- post_id - номер поста,
- source - трафик (ads - реклама, organic).

message_action (мессенджер):
- user_id - id пользователя, который отправляет сообщение,
- reciever_id - id пользователя, который получает сообщение,
- time - время,
- source - трафик (ads - реклама, organic),
- gender - гендер пользователя (0- мужчина, 1- женщина),
- age (возраст пользователя),
- country - страна,
- city - город,
- os - операционная система (ios, android).

## Задание
Написать систему алертов для приложения. Система должна с периодичность каждые 15 минут проверять ключевые метрики, такие как активные пользователи в ленте / мессенджере, просмотры, лайки, CTR, количество отправленных сообщений и, в случае отклонений метрик, отправлять сообщение и график в телеграм-чат.
Автоматизировать систему алертов с помощью Airflow.

## Решение
Создан DAG, который работает через Apache Airflow, и проверяет наличие выбросов. В случае появления выбросов, отправляет сообщение в телеграм-чат. 

## Результат - сообщение в телеграм-чат
![Screenshot_anomaly](https://user-images.githubusercontent.com/122218714/211324514-10a4c722-8f91-4a3f-a166-5e67669db114.png)
